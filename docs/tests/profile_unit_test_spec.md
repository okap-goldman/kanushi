# プロフィール画面 単体テスト仕様書

## 概要
本ドキュメントはkanushiアプリケーションのプロフィール画面に関する単体テスト仕様を定義します。プロフィール画面の各コンポーネントと機能に対するテストケースを記述し、品質保証の基準を提供します。

## テスト対象コンポーネント
1. `Profile.tsx` - プロフィールページのメインコンポーネント
2. `ProfileHeader.tsx` - プロフィールヘッダー部分のコンポーネント
3. `ProfileTabs.tsx` - プロフィールタブ部分のコンポーネント
4. `edit-form.tsx` - プロフィール編集フォームのコンポーネント

## テスト環境設定

### 必要なモック

1. Firebase Authentication
   - ログイン済みユーザー情報のモック

2. Firestore
   - ユーザードキュメントのモック
   - 投稿データのモック

3. ローカルストレージ
   - 開発環境用のモックユーザープロフィール

### テストデータ

1. 標準ユーザー
```json
{
  "uid": "test-user-id",
  "user_id": "123456789",
  "user_name": "テストユーザー",
  "profile_icon_url": "https://example.com/profile.jpg",
  "profile_audio_url": "https://example.com/audio.mp3",
  "shop_link_url": "https://example.com/shop",
  "is_shop_link": true,
  "introduction": "これはテスト用の自己紹介文です。"
}
```

2. 最小限ユーザー（未設定項目あり）
```json
{
  "uid": "minimal-user-id",
  "user_id": "987654321"
}
```

3. 開発環境用モックユーザー
```json
{
  "uid": "12345678",
  "user_id": "12345678",
  "user_name": "開発ユーザー",
  "profile_icon_url": "https://api.dicebear.com/7.x/avataaars/svg?seed=1",
  "profile_audio_url": "",
  "shop_link_url": "https://example.com/dev-shop",
  "is_shop_link": true,
  "introduction": "これは開発環境用のモックユーザーです。"
}
```

## 注意事項

1. テスト実行前に、必要なモックとテストデータを適切に設定すること
2. 開発環境とプロダクション環境の両方でテストを実施すること
3. 音声録音機能のテストは、マイクへのアクセス権限が必要
4. 画像アップロード機能のテストは、適切なサイズと形式のテスト画像を用意すること

## テストケース

### テスト画像

テスト用に以下の画像ファイルを用意しています：

1. 有効な画像ファイル
   - JPEG形式: `docs/tests/images/valid_profile_image.jpg`
   - PNG形式: `docs/tests/images/valid_profile_image.png`
   - GIF形式: `docs/tests/images/valid_profile_image.gif`
   - WebP形式: `docs/tests/images/valid_profile_image.webp`

2. 無効な画像ファイル
   - サイズ超過（5MB以上）: `docs/tests/images/invalid_large_image.jpg`
   - 非対応形式: `docs/tests/images/invalid_format_image.txt`

### テストケース一覧

| No. | 画面名 | 機能名 | 系列 | 前提条件 | テスト手順 | 期待される結果 | テスト結果 | コメント |
|-----|--------|--------|------|----------|------------|----------------|------------|---------|
| 1.1 | プロフィール | ユーザー情報の表示 | 正常系 | - ユーザーが認証済みであること<br>- ユーザー情報がFirestoreに存在すること | 1. プロフィールページにアクセスする<br>2. ユーザー情報の表示を確認する | - ユーザー名が正しく表示される<br>- プロフィール画像が正しく表示される<br>- 自己紹介文が正しく表示される<br>- フォロー数/フォロワー数が表示される | | |
| 1.2 | プロフィール | 未設定項目の表示 | 正常系 | - ユーザーが認証済みであること<br>- 一部のプロフィール情報が未設定であること | 1. プロフィールページにアクセスする<br>2. 未設定項目の表示を確認する | - 名前が未設定の場合「名称未設定」と表示される<br>- プロフィール画像が未設定の場合デフォルト画像が表示される<br>- 自己紹介が未設定の場合空欄で表示される | | |
| 1.3 | プロフィール | 開発環境でのモックユーザー対応 | 正常系 | - 開発環境（MODE='development'）であること<br>- テスト用メールアドレスが環境変数に設定されていること<br>- ユーザーIDが'12345678'であること<br>- ローカルストレージにモックユーザープロフィールが保存されていること | 1. 開発環境でプロフィールページにアクセスする<br>2. ローカルストレージからモックユーザー情報が読み込まれることを確認する | - ローカルストレージから読み込まれたモックユーザー情報が表示される | | |
| 2.1 | プロフィール | 自己紹介音声の再生 | 正常系 | - ユーザーが認証済みであること<br>- 自己紹介音声が設定されていること | 1. プロフィールページにアクセスする<br>2. 音声再生ボタンをクリックする | - 音声が再生される<br>- 再生中は再生ボタンが一時停止ボタンに変わる | | |
| 2.2 | プロフィール | 自己紹介音声の一時停止 | 正常系 | - ユーザーが認証済みであること<br>- 自己紹介音声が再生中であること | 1. 一時停止ボタンをクリックする | - 音声の再生が停止する<br>- 一時停止ボタンが再生ボタンに変わる | | |
| 2.3 | プロフィール | 自己紹介音声が未設定の場合 | 正常系 | - ユーザーが認証済みであること<br>- 自己紹介音声が設定されていないこと | 1. プロフィールページにアクセスする<br>2. 音声再生ボタンをクリックする | - 音声が再生されない<br>- ボタンの状態が変化しない | | |
| 3.1 | プロフィール | タブの切り替え | 正常系 | - ユーザーが認証済みであること | 1. プロフィールページにアクセスする<br>2. 各タブ（メディア、音声、テキスト、ハイライト、イベント）をクリックする | - クリックしたタブがアクティブになる<br>- タブに対応するコンテンツが表示される | | |
| 3.2 | プロフィール | メディアタブの表示 | 正常系 | - ユーザーが認証済みであること<br>- メディア投稿が存在すること | 1. プロフィールページにアクセスする<br>2. メディアタブをクリックする | - メディア投稿がグリッド形式で表示される | | |
| 3.3 | プロフィール | メディアタブの投稿が存在しない場合 | 正常系 | - ユーザーが認証済みであること<br>- メディア投稿が存在しないこと | 1. プロフィールページにアクセスする<br>2. メディアタブをクリックする | - 空のグリッドが表示される | | |
| 4.1 | プロフィール | 編集モーダルの表示 | 正常系 | - ユーザーが認証済みであること | 1. プロフィールページにアクセスする<br>2. 設定アイコンをクリックする | - プロフィール編集モーダルが表示される<br>- 現在のプロフィール情報がフォームに入力されている | | |
| 4.2 | プロフィール | プロフィール画像の変更 | 正常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. 「写真やアバターを変更」ボタンをクリックする<br>2. 有効な画像ファイル（5MB以下のJPEG/PNG/GIF/WebP）を選択する<br>3. 「完了」ボタンをクリックする | - 選択した画像がプレビュー表示される<br>- 画像がアップロードされる<br>- プロフィール画像が更新される | | |
| 4.3 | プロフィール | プロフィール画像の変更（無効なファイル） | 異常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. 「写真やアバターを変更」ボタンをクリックする<br>2. 無効なファイル（5MB超過または非対応形式）を選択する | - エラーメッセージが表示される<br>- 画像がアップロードされない | | |
| 4.4 | プロフィール | 名前の変更 | 正常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. 名前入力欄に新しい名前（50文字以内）を入力する<br>2. 「完了」ボタンをクリックする | - 名前が更新される<br>- 更新された名前がプロフィールページに表示される | | |
| 4.5 | プロフィール | 名前の変更（無効な入力） | 異常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. 名前入力欄に無効な名前（空欄または50文字超過）を入力する<br>2. 「完了」ボタンをクリックする | - エラーメッセージが表示される<br>- 名前が更新されない | | |
| 4.6 | プロフィール | 自己紹介の変更 | 正常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. 自己紹介入力欄に新しい自己紹介（280文字以内）を入力する<br>2. 「完了」ボタンをクリックする | - 自己紹介が更新される<br>- 更新された自己紹介がプロフィールページに表示される | | |
| 4.7 | プロフィール | 自己紹介の変更（無効な入力） | 異常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. 自己紹介入力欄に無効な自己紹介（空欄または280文字超過）を入力する<br>2. 「完了」ボタンをクリックする | - エラーメッセージが表示される<br>- 自己紹介が更新されない | | |
| 4.8 | プロフィール | 外部リンクの変更 | 正常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. リンク入力欄に有効なURL（http://またはhttps://で始まる）を入力する<br>2. 「完了」ボタンをクリックする | - 外部リンクが更新される | | |
| 4.9 | プロフィール | 外部リンクの変更（無効な入力） | 異常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. リンク入力欄に無効なURL（http://またはhttps://で始まらない）を入力する<br>2. 「完了」ボタンをクリックする | - エラーメッセージが表示される<br>- 外部リンクが更新されない | | |
| 5.1 | プロフィール | 音声録音の開始 | 正常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること<br>- マイクへのアクセス権限があること | 1. 「録音する」ボタンをクリックする<br>2. 録音ボタンをクリックする | - 録音が開始される<br>- 録音中の表示に切り替わる | | |
| 5.2 | プロフィール | 音声録音の停止 | 正常系 | - ユーザーが認証済みであること<br>- 音声録音が進行中であること | 1. 停止ボタンをクリックする | - 録音が停止される<br>- 録音完了の表示に切り替わる<br>- 録音された音声が再生可能になる | | |
| 5.3 | プロフィール | 録音した音声の再生 | 正常系 | - ユーザーが認証済みであること<br>- 音声が録音済みであること | 1. 再生ボタンをクリックする | - 録音された音声が再生される<br>- 再生中は再生ボタンが一時停止ボタンに変わる | | |
| 5.4 | プロフィール | 録音した音声の確定 | 正常系 | - ユーザーが認証済みであること<br>- 音声が録音済みであること | 1. 「確定」ボタンをクリックする<br>2. 「完了」ボタンをクリックする | - 録音UIが閉じる<br>- 音声がアップロードされる<br>- プロフィールの自己紹介音声が更新される | | |
| 5.5 | プロフィール | 録音した音声の再録音 | 正常系 | - ユーザーが認証済みであること<br>- 音声が録音済みであること | 1. 「再録音」ボタンをクリックする | - 録音UIが録音開始状態に戻る<br>- 新しい録音が開始される | | |
| 5.6 | プロフィール | マイク権限がない場合の録音 | 異常系 | - ユーザーが認証済みであること<br>- マイクへのアクセス権限がないこと | 1. 「録音する」ボタンをクリックする<br>2. 録音ボタンをクリックする | - エラーメッセージが表示される<br>- 録音が開始されない | | |
| 6.1 | プロフィール | プロフィール情報の保存 | 正常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること<br>- 有効な入力値が設定されていること | 1. 「完了」ボタンをクリックする | - プロフィール情報がFirestoreに保存される<br>- 編集モーダルが閉じる<br>- 更新されたプロフィール情報が表示される | | |
| 6.2 | プロフィール | プロフィール更新のキャンセル | 正常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること | 1. 「キャンセル」ボタンをクリックする | - 編集モーダルが閉じる<br>- プロフィール情報が更新されない | | |
| 6.3 | プロフィール | プロフィール更新時のエラー処理 | 異常系 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること<br>- Firestoreへの書き込みが失敗する状況であること | 1. 「完了」ボタンをクリックする | - エラーメッセージが表示される<br>- プロフィール情報が更新されない | | |
| 7.1 | プロフィール | モックユーザープロフィールの更新 | 正常系 | - 開発環境（MODE='development'）であること<br>- テスト用メールアドレスが環境変数に設定されていること<br>- ユーザーIDが'12345678'であること | 1. プロフィール編集モーダルで情報を変更する<br>2. 「完了」ボタンをクリックする | - ローカルストレージにモックユーザープロフィールが保存される<br>- 更新されたプロフィール情報が表示される | | |
