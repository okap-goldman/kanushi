# プロフィール画面 単体テスト仕様書

## 概要
本ドキュメントはkanushiアプリケーションのプロフィール画面に関する単体テスト仕様を定義します。プロフィール画面の各コンポーネントと機能に対するテストケースを記述し、品質保証の基準を提供します。

## テスト対象コンポーネント
1. `Profile.tsx` - プロフィールページのメインコンポーネント
2. `ProfileHeader.tsx` - プロフィールヘッダー部分のコンポーネント
3. `ProfileTabs.tsx` - プロフィールタブ部分のコンポーネント
4. `edit-form.tsx` - プロフィール編集フォームのコンポーネント

## テストケース

### 1. プロフィール表示機能

#### 1.1 ユーザー情報の表示

| 項目 | 内容 |
|------|------|
| 機能名 | ユーザー情報の表示 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- ユーザー情報がFirestoreに存在すること |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. ユーザー情報の表示を確認する |
| 期待される結果 | - ユーザー名が正しく表示される<br>- プロフィール画像が正しく表示される<br>- 自己紹介文が正しく表示される<br>- フォロー数/フォロワー数が表示される |
| テスト結果 | |
| コメント | |

#### 1.2 未設定項目の表示

| 項目 | 内容 |
|------|------|
| 機能名 | 未設定項目の表示 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 一部のプロフィール情報が未設定であること |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. 未設定項目の表示を確認する |
| 期待される結果 | - 名前が未設定の場合「名称未設定」と表示される<br>- プロフィール画像が未設定の場合デフォルト画像が表示される<br>- 自己紹介が未設定の場合空欄で表示される |
| テスト結果 | |
| コメント | |

#### 1.3 開発環境でのモックユーザー対応

| 項目 | 内容 |
|------|------|
| 機能名 | 開発環境でのモックユーザー対応 |
| 系列 | 正常系 |
| 前提条件 | - 開発環境（MODE='development'）であること<br>- テスト用メールアドレスが環境変数に設定されていること<br>- ユーザーIDが'12345678'であること<br>- ローカルストレージにモックユーザープロフィールが保存されていること |
| テスト手順 | 1. 開発環境でプロフィールページにアクセスする<br>2. ローカルストレージからモックユーザー情報が読み込まれることを確認する |
| 期待される結果 | - ローカルストレージから読み込まれたモックユーザー情報が表示される |
| テスト結果 | |
| コメント | |

### 2. 音声再生機能

#### 2.1 自己紹介音声の再生

| 項目 | 内容 |
|------|------|
| 機能名 | 自己紹介音声の再生 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 自己紹介音声が設定されていること |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. 音声再生ボタンをクリックする |
| 期待される結果 | - 音声が再生される<br>- 再生中は再生ボタンが一時停止ボタンに変わる |
| テスト結果 | |
| コメント | |

#### 2.2 自己紹介音声の一時停止

| 項目 | 内容 |
|------|------|
| 機能名 | 自己紹介音声の一時停止 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 自己紹介音声が再生中であること |
| テスト手順 | 1. 一時停止ボタンをクリックする |
| 期待される結果 | - 音声の再生が停止する<br>- 一時停止ボタンが再生ボタンに変わる |
| テスト結果 | |
| コメント | |

#### 2.3 自己紹介音声が未設定の場合

| 項目 | 内容 |
|------|------|
| 機能名 | 自己紹介音声が未設定の場合 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 自己紹介音声が設定されていないこと |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. 音声再生ボタンをクリックする |
| 期待される結果 | - 音声が再生されない<br>- ボタンの状態が変化しない |
| テスト結果 | |
| コメント | |

### 3. タブ切り替え機能

#### 3.1 タブの切り替え

| 項目 | 内容 |
|------|------|
| 機能名 | タブの切り替え |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. 各タブ（メディア、音声、テキスト、ハイライト、イベント）をクリックする |
| 期待される結果 | - クリックしたタブがアクティブになる<br>- タブに対応するコンテンツが表示される |
| テスト結果 | |
| コメント | |

#### 3.2 メディアタブの表示

| 項目 | 内容 |
|------|------|
| 機能名 | メディアタブの表示 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- メディア投稿が存在すること |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. メディアタブをクリックする |
| 期待される結果 | - メディア投稿がグリッド形式で表示される |
| テスト結果 | |
| コメント | |

#### 3.3 メディアタブの投稿が存在しない場合

| 項目 | 内容 |
|------|------|
| 機能名 | メディアタブの投稿が存在しない場合 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- メディア投稿が存在しないこと |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. メディアタブをクリックする |
| 期待される結果 | - 空のグリッドが表示される |
| テスト結果 | |
| コメント | |

### 4. プロフィール編集機能

#### 4.1 編集モーダルの表示

| 項目 | 内容 |
|------|------|
| 機能名 | 編集モーダルの表示 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること |
| テスト手順 | 1. プロフィールページにアクセスする<br>2. 設定アイコンをクリックする |
| 期待される結果 | - プロフィール編集モーダルが表示される<br>- 現在のプロフィール情報がフォームに入力されている |
| テスト結果 | |
| コメント | |

#### 4.2 プロフィール画像の変更

| 項目 | 内容 |
|------|------|
| 機能名 | プロフィール画像の変更 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. 「写真やアバターを変更」ボタンをクリックする<br>2. 有効な画像ファイル（5MB以下のJPEG/PNG/GIF/WebP）を選択する<br>3. 「完了」ボタンをクリックする |
| 期待される結果 | - 選択した画像がプレビュー表示される<br>- 画像がアップロードされる<br>- プロフィール画像が更新される |
| テスト結果 | |
| コメント | |

#### 4.3 プロフィール画像の変更（無効なファイル）

| 項目 | 内容 |
|------|------|
| 機能名 | プロフィール画像の変更（無効なファイル） |
| 系列 | 異常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. 「写真やアバターを変更」ボタンをクリックする<br>2. 無効なファイル（5MB超過または非対応形式）を選択する |
| 期待される結果 | - エラーメッセージが表示される<br>- 画像がアップロードされない |
| テスト結果 | |
| コメント | |

#### 4.4 名前の変更

| 項目 | 内容 |
|------|------|
| 機能名 | 名前の変更 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. 名前入力欄に新しい名前（50文字以内）を入力する<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - 名前が更新される<br>- 更新された名前がプロフィールページに表示される |
| テスト結果 | |
| コメント | |

#### 4.5 名前の変更（無効な入力）

| 項目 | 内容 |
|------|------|
| 機能名 | 名前の変更（無効な入力） |
| 系列 | 異常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. 名前入力欄に無効な名前（空欄または50文字超過）を入力する<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - エラーメッセージが表示される<br>- 名前が更新されない |
| テスト結果 | |
| コメント | |

#### 4.6 自己紹介の変更

| 項目 | 内容 |
|------|------|
| 機能名 | 自己紹介の変更 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. 自己紹介入力欄に新しい自己紹介（280文字以内）を入力する<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - 自己紹介が更新される<br>- 更新された自己紹介がプロフィールページに表示される |
| テスト結果 | |
| コメント | |

#### 4.7 自己紹介の変更（無効な入力）

| 項目 | 内容 |
|------|------|
| 機能名 | 自己紹介の変更（無効な入力） |
| 系列 | 異常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. 自己紹介入力欄に無効な自己紹介（空欄または280文字超過）を入力する<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - エラーメッセージが表示される<br>- 自己紹介が更新されない |
| テスト結果 | |
| コメント | |

#### 4.8 外部リンクの変更

| 項目 | 内容 |
|------|------|
| 機能名 | 外部リンクの変更 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. リンク入力欄に有効なURL（http://またはhttps://で始まる）を入力する<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - 外部リンクが更新される |
| テスト結果 | |
| コメント | |

#### 4.9 外部リンクの変更（無効な入力）

| 項目 | 内容 |
|------|------|
| 機能名 | 外部リンクの変更（無効な入力） |
| 系列 | 異常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. リンク入力欄に無効なURL（http://またはhttps://で始まらない）を入力する<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - エラーメッセージが表示される<br>- 外部リンクが更新されない |
| テスト結果 | |
| コメント | |

### 5. 自己紹介音声録音機能

#### 5.1 音声録音の開始

| 項目 | 内容 |
|------|------|
| 機能名 | 音声録音の開始 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること<br>- マイクへのアクセス権限があること |
| テスト手順 | 1. 「録音する」ボタンをクリックする<br>2. 録音ボタンをクリックする |
| 期待される結果 | - 録音が開始される<br>- 録音中の表示に切り替わる |
| テスト結果 | |
| コメント | |

#### 5.2 音声録音の停止

| 項目 | 内容 |
|------|------|
| 機能名 | 音声録音の停止 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 音声録音が進行中であること |
| テスト手順 | 1. 停止ボタンをクリックする |
| 期待される結果 | - 録音が停止される<br>- 録音完了の表示に切り替わる<br>- 録音された音声が再生可能になる |
| テスト結果 | |
| コメント | |

#### 5.3 録音した音声の再生

| 項目 | 内容 |
|------|------|
| 機能名 | 録音した音声の再生 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 音声が録音済みであること |
| テスト手順 | 1. 再生ボタンをクリックする |
| 期待される結果 | - 録音された音声が再生される<br>- 再生中は再生ボタンが一時停止ボタンに変わる |
| テスト結果 | |
| コメント | |

#### 5.4 録音した音声の確定

| 項目 | 内容 |
|------|------|
| 機能名 | 録音した音声の確定 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 音声が録音済みであること |
| テスト手順 | 1. 「確定」ボタンをクリックする<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - 録音UIが閉じる<br>- 音声がアップロードされる<br>- プロフィールの自己紹介音声が更新される |
| テスト結果 | |
| コメント | |

#### 5.5 録音した音声の再録音

| 項目 | 内容 |
|------|------|
| 機能名 | 録音した音声の再録音 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- 音声が録音済みであること |
| テスト手順 | 1. 「再録音」ボタンをクリックする |
| 期待される結果 | - 録音UIが録音開始状態に戻る<br>- 新しい録音が開始される |
| テスト結果 | |
| コメント | |

#### 5.6 マイク権限がない場合の録音

| 項目 | 内容 |
|------|------|
| 機能名 | マイク権限がない場合の録音 |
| 系列 | 異常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- マイクへのアクセス権限がないこと |
| テスト手順 | 1. 「録音する」ボタンをクリックする<br>2. 録音ボタンをクリックする |
| 期待される結果 | - エラーメッセージが表示される<br>- 録音が開始されない |
| テスト結果 | |
| コメント | |

### 6. プロフィール更新処理

#### 6.1 プロフィール情報の保存

| 項目 | 内容 |
|------|------|
| 機能名 | プロフィール情報の保存 |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること<br>- 有効な入力値が設定されていること |
| テスト手順 | 1. 「完了」ボタンをクリックする |
| 期待される結果 | - プロフィール情報がFirestoreに保存される<br>- 編集モーダルが閉じる<br>- 更新されたプロフィール情報が表示される |
| テスト結果 | |
| コメント | |

#### 6.2 プロフィール更新のキャンセル

| 項目 | 内容 |
|------|------|
| 機能名 | プロフィール更新のキャンセル |
| 系列 | 正常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること |
| テスト手順 | 1. 「キャンセル」ボタンをクリックする |
| 期待される結果 | - 編集モーダルが閉じる<br>- プロフィール情報が更新されない |
| テスト結果 | |
| コメント | |

#### 6.3 プロフィール更新時のエラー処理

| 項目 | 内容 |
|------|------|
| 機能名 | プロフィール更新時のエラー処理 |
| 系列 | 異常系 |
| 前提条件 | - ユーザーが認証済みであること<br>- プロフィール編集モーダルが表示されていること<br>- Firestoreへの書き込みが失敗する状況であること |
| テスト手順 | 1. 「完了」ボタンをクリックする |
| 期待される結果 | - エラーメッセージが表示される<br>- プロフィール情報が更新されない |
| テスト結果 | |
| コメント | |

### 7. 開発環境特有の機能

#### 7.1 モックユーザープロフィールの更新

| 項目 | 内容 |
|------|------|
| 機能名 | モックユーザープロフィールの更新 |
| 系列 | 正常系 |
| 前提条件 | - 開発環境（MODE='development'）であること<br>- テスト用メールアドレスが環境変数に設定されていること<br>- ユーザーIDが'12345678'であること |
| テスト手順 | 1. プロフィール編集モーダルで情報を変更する<br>2. 「完了」ボタンをクリックする |
| 期待される結果 | - ローカルストレージにモックユーザープロフィールが保存される<br>- 更新されたプロフィール情報が表示される |
| テスト結果 | |
| コメント | |

## テスト環境設定

### 必要なモック

1. Firebase Authentication
   - ログイン済みユーザー情報のモック

2. Firestore
   - ユーザードキュメントのモック
   - 投稿データのモック

3. ローカルストレージ
   - 開発環境用のモックユーザープロフィール

### テストデータ

1. 標準ユーザー
```json
{
  "uid": "test-user-id",
  "user_id": "123456789",
  "user_name": "テストユーザー",
  "profile_icon_url": "https://example.com/profile.jpg",
  "profile_audio_url": "https://example.com/audio.mp3",
  "shop_link_url": "https://example.com/shop",
  "is_shop_link": true,
  "introduction": "これはテスト用の自己紹介文です。"
}
```

2. 最小限ユーザー（未設定項目あり）
```json
{
  "uid": "minimal-user-id",
  "user_id": "987654321"
}
```

3. 開発環境用モックユーザー
```json
{
  "uid": "12345678",
  "user_id": "12345678",
  "user_name": "開発ユーザー",
  "profile_icon_url": "https://api.dicebear.com/7.x/avataaars/svg?seed=1",
  "profile_audio_url": "",
  "shop_link_url": "https://example.com/dev-shop",
  "is_shop_link": true,
  "introduction": "これは開発環境用のモックユーザーです。"
}
```

## 注意事項

1. テスト実行前に、必要なモックとテストデータを適切に設定すること
2. 開発環境とプロダクション環境の両方でテストを実施すること
3. 音声録音機能のテストは、マイクへのアクセス権限が必要
4. 画像アップロード機能のテストは、適切なサイズと形式のテスト画像を用意すること
