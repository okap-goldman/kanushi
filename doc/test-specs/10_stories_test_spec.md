# ストーリーズ機能テスト仕様書

## 概要
本ドキュメントは、ストーリーズ機能のTDD実装のための詳細なテスト仕様書です。
一時的なユーザーコンテンツの投稿、表示、インタラクションに関するテストケースを定義します。

## 1. API単体テスト

### 1.1 ストーリー作成API

**テストケース**: 画像ストーリー作成
- **入力**: 画像ファイル、キャプション（オプション）、場所（オプション）
- **期待結果**: ストーリーID、作成日時、有効期限（24時間後）を含むレスポンス

**テストケース**: テキストのみのストーリー作成
- **入力**: テキスト内容、背景色/パターン
- **期待結果**: ストーリーID、作成日時を含むレスポンス

**テストケース**: 無効なコンテンツでのエラー処理
- **入力**: サポート外のファイル形式
- **期待結果**: 適切なエラーメッセージ

**テストケース**: 認証必須の確認
- **入力**: 認証トークンなしでのリクエスト
- **期待結果**: 401エラー

### 1.2 ストーリー取得API

**テストケース**: フォロー中ユーザーのストーリー一覧取得
- **入力**: ユーザーID
- **期待結果**: フォロー中ユーザーのアクティブなストーリーのリスト

**テストケース**: 特定ユーザーのストーリー一覧取得
- **入力**: 特定のユーザーID
- **期待結果**: そのユーザーのアクティブなストーリーのリスト

**テストケース**: ストーリー詳細取得
- **入力**: ストーリーID
- **期待結果**: ストーリーの詳細情報、閲覧数、リアクション情報

**テストケース**: 期限切れストーリーの処理
- **入力**: 24時間以上経過したストーリーID
- **期待結果**: 404エラーまたは「期限切れ」ステータス

### 1.3 ストーリーインタラクションAPI

**テストケース**: ストーリーへのリアクション送信
- **入力**: ストーリーID、リアクション種類（絵文字）
- **期待結果**: リアクション登録確認

**テストケース**: ストーリー返信の送信
- **入力**: ストーリーID、返信テキスト
- **期待結果**: 返信ID、送信確認

**テストケース**: ストーリー閲覧ステータス更新
- **入力**: ストーリーID、ユーザーID
- **期待結果**: 閲覧記録の更新確認

**テストケース**: 不適切なコンテンツの報告
- **入力**: ストーリーID、報告理由
- **期待結果**: 報告ID、受付確認

## 2. UI単体テスト

### 2.1 ストーリー作成コンポーネント

**テストケース**: ストーリー作成UIの表示
- **入力**: 初期表示
- **期待結果**: カメラ/ギャラリー選択UI、テキスト入力オプションの表示

**テストケース**: 画像選択とプレビュー
- **入力**: 画像選択アクション
- **期待結果**: 選択した画像のプレビュー表示、編集オプションの表示

**テストケース**: テキスト入力と書式設定
- **入力**: テキスト入力、フォント/色変更
- **期待結果**: スタイル適用されたテキストプレビュー

**テストケース**: 位置情報追加
- **入力**: 位置情報選択アクション
- **期待結果**: 位置情報検索UI表示、選択後のプレビュー

**テストケース**: ストーリー投稿アクション
- **入力**: 投稿ボタンタップ
- **期待結果**: 投稿進行状況表示、成功後の確認メッセージ

### 2.2 ストーリー表示コンポーネント

**テストケース**: ストーリーリングの表示
- **入力**: ユーザーリスト
- **期待結果**: アクティブなストーリーを持つユーザーにリングが表示される

**テストケース**: ストーリービューアの基本表示
- **入力**: ストーリー選択アクション
- **期待結果**: フルスクリーンビューア表示、ユーザー情報、タイムスタンプ表示

**テストケース**: 複数ストーリーのナビゲーション
- **入力**: タップ/スワイプジェスチャー
- **期待結果**: 次/前のストーリーへの移動

**テストケース**: ストーリー進行状況表示
- **入力**: ストーリー表示
- **期待結果**: 進行状況インジケーターの表示と自動進行

**テストケース**: 長押しによるポーズ機能
- **入力**: 画面長押し
- **期待結果**: ストーリーの自動進行が一時停止

**テストケース**: インタラクションUIの表示
- **入力**: 上スワイプジェスチャー
- **期待結果**: 返信/リアクションUIの表示

### 2.3 ストーリーインタラクションコンポーネント

**テストケース**: リアクション送信UI
- **入力**: リアクションボタンタップ
- **期待結果**: リアクション選択UIの表示、送信アクション

**テストケース**: 返信入力UI
- **入力**: 返信ボタンタップ
- **期待結果**: 返信入力フィールド表示、送信ボタン

**テストケース**: シェアアクションUI
- **入力**: シェアボタンタップ
- **期待結果**: シェアオプション表示（DM、外部アプリ）

**テストケース**: 閲覧者リスト表示
- **入力**: 閲覧数表示タップ
- **期待結果**: 閲覧者リストモーダル表示

## 3. 結合テスト

### 3.1 ストーリー投稿フロー

**テストケース**: 画像ストーリー投稿の完全フロー
- **手順**:
  1. ストーリー作成画面表示
  2. 画像選択
  3. 編集（フィルター適用）
  4. キャプション追加
  5. 位置情報追加
  6. プライバシー設定
  7. 投稿実行
- **期待結果**: 一連のフローが正常に完了し、APIが正しく呼び出される

**テストケース**: テキストストーリー投稿フロー
- **手順**:
  1. テキスト入力モード選択
  2. テキスト入力
  3. 背景/フォント設定
  4. 投稿実行
- **期待結果**: テキストストーリーが作成され、保存される

### 3.2 ストーリー閲覧フロー

**テストケース**: フォロー中ユーザーのストーリー閲覧
- **手順**:
  1. ホーム画面でのストーリーリング表示
  2. ストーリーリングタップ
  3. ストーリービューア表示
  4. 自動再生と進行
  5. 複数ユーザーのストーリー間ナビゲーション
- **期待結果**: ストーリーが連続して表示され、閲覧ステータスが更新される

**テストケース**: インタラクションを含む閲覧フロー
- **手順**:
  1. ストーリー表示
  2. リアクション送信
  3. 返信送信
  4. 閲覧者リスト確認
- **期待結果**: インタラクションが正しく送信され、UIが適切に更新される

## 4. E2Eテスト

### 4.1 ストーリー機能の包括的E2Eテスト

**テストケース**: ストーリー投稿から閲覧までのエンドツーエンドフロー
- **手順**:
  1. ユーザーログイン
  2. ストーリー作成と投稿
  3. 別ユーザーアカウントでのログイン
  4. 投稿したストーリーの閲覧
  5. リアクション送信
  6. 元のユーザーでリアクション通知確認
- **期待結果**: 実際の環境での完全なフローが正常に動作する

**テストケース**: ストーリーのライフサイクルテスト
- **手順**:
  1. ストーリー投稿
  2. 閲覧統計の確認
  3. 24時間経過後の表示確認
  4. アーカイブでの確認
- **期待結果**: ストーリーが適切なライフサイクルで管理される

**テストケース**: 期限切れ間近のストーリー挙動
- **手順**:
  1. 期限切れ間近のストーリーを作成（テスト用に短時間設定）
  2. 期限前の表示確認
  3. 期限切れ後の表示確認
- **期待結果**: 期限切れ直前は表示され、期限後は非表示になる

## テスト実行計画

### 優先度設定
1. API単体テスト（基本機能の保証）
2. UI単体テスト（表示の正確性）
3. 結合テスト（フロー全体の整合性）
4. E2Eテスト（実環境での動作）

### カバレッジ目標
- API単体テスト: 95%以上
- UI単体テスト: 90%以上
- 結合テスト: 主要フローをカバー
- E2Eテスト: 主要ユーザーシナリオをカバー

## まとめ

TDDアプローチでの実装時は、これらのテストケースを段階的に実装し、グリーンにしていくことで、堅牢なストーリーズ機能を構築できます。