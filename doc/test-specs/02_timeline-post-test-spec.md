# タイムライン・投稿機能テスト仕様書

## 概要
本ドキュメントは「目醒め人のためのSNS」のタイムライン・投稿機能に関するテスト仕様を定義します。この仕様書に基づいて開発チームがテストコードを実装し、品質保証を行います。

## テスト対象機能
- タイムライン表示
- 投稿作成（音声、画像、テキスト）
- 投稿への反応（いいね、ハイライト、コメント、ブックマーク）
- オフライン機能
- エラー処理

## 1. APIレベルテスト

### 1.1 タイムライン取得機能

#### 1.1.1 ファミリータイムライン
| テストケース | 説明 | 期待結果 |
|------------|------|---------|
| 正常取得 | ファミリーフォローの投稿を時系列順に取得 | ステータス200、投稿リストが新しい順に返される |
| ページネーション | カーソルを使用した続きのページ取得 | 次の20件が取得される |
| 認証エラー | 認証トークンなしでアクセス | ステータス401エラー |

#### 1.1.2 ウォッチタイムライン
| テストケース | 説明 | 期待結果 |
|------------|------|---------|
| 正常取得 | ウォッチフォローの投稿を取得 | ステータス200、ウォッチフォローのみの投稿が返される |

### 1.2 投稿作成機能

#### 1.2.1 音声投稿
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 正常投稿 | 音声ファイルと説明文で投稿作成 | ステータス201、波形生成、AI要約生成 |
| イベントタグ付き | イベントに関連付けた音声投稿 | 投稿にイベントIDが紐付く |
| ファイルサイズ超過 | 50MBを超える音声ファイル | ステータス413エラー |

#### 1.2.2 画像投稿
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 正常投稿 | JPEG/PNG画像の投稿 | ステータス201、プレビュー画像生成 |
| GIF投稿 | アニメーションGIFの投稿 | GIFファイルがそのまま保存される |

#### 1.2.3 テキスト投稿
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 正常投稿 | テキストのみの投稿 | ステータス201 |
| 最大文字数 | 10,000文字のテキスト投稿 | 正常に投稿される |
| 文字数超過 | 10,001文字以上のテキスト | ステータス400エラー |
| ハッシュタグ | 最大5個のハッシュタグ付き投稿 | ハッシュタグが保存される |

### 1.3 投稿アクション機能

#### 1.3.1 いいね機能
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| いいね追加 | 投稿にいいねする | ステータス204 |
| 重複いいね | 同じ投稿に2回いいね | ステータス409エラー |
| 存在しない投稿 | 存在しない投稿にいいね | ステータス404エラー |
| いいね取り消し | いいねを解除する | ステータス204 |

#### 1.3.2 ハイライト機能
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 正常ハイライト | 理由付きでハイライト | ステータス201、理由が保存される |
| 理由なし | 理由を入力せずハイライト | ステータス400エラー |
| 重複ハイライト | 同じ投稿を2回ハイライト | ステータス409エラー |

#### 1.3.3 コメント機能
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| コメント投稿 | 投稿にコメントを追加 | ステータス201 |
| 空コメント | 空のコメントを投稿 | ステータス400エラー |
| コメント一覧取得 | 投稿のコメント一覧を取得 | ステータス200、コメントリスト |

#### 1.3.4 ブックマーク機能
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| ブックマーク追加 | 投稿をブックマークに追加 | ステータス201 |
| ブックマーク解除 | ブックマークを削除 | ステータス204 |
| ブックマーク一覧 | 自分のブックマーク一覧を取得 | ステータス200、ページネーション付き |

#### 1.3.5 投稿削除
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 自分の投稿削除 | 自分が作成した投稿を削除 | ステータス204 |
| 他人の投稿削除 | 他人の投稿を削除試行 | ステータス403エラー |

### 1.4 オフライン機能
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| オフライン保存 | 投稿をオフライン用に保存 | ステータス201 |
| 重複保存 | 既に保存済みの投稿を保存 | ステータス409エラー |
| 保存一覧取得 | オフライン保存済み一覧 | ステータス200、容量情報付き |

### 1.5 レート制限
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 投稿数制限 | 1分間に11件の投稿試行 | 10件目まで成功、11件目は429エラー |

## 2. UIレベルテスト

### 2.1 タイムライン画面
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 初期表示 | 画面読み込み時の表示 | ローディングインジケーターが表示される |
| タブ切り替え | ファミリー/ウォッチの切り替え | 選択したタブのコンテンツが表示される |
| プルトゥリフレッシュ | 下に引っ張って更新 | 最新の投稿が読み込まれる |
| 無限スクロール | 下までスクロール | 自動的に次のページが読み込まれる |

### 2.2 投稿カードコンポーネント
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 投稿表示 | 投稿内容の表示確認 | ユーザー名、本文、いいね数、コメント数が表示される |
| いいねボタン | いいねボタンの動作 | ボタンがアクティブになる |
| ハイライトボタン | ハイライトボタンの動作 | 理由入力ダイアログが表示される |
| 削除ボタン表示（自分の投稿） | 自分の投稿に削除ボタン | 削除ボタンが表示される |
| 削除ボタン非表示（他人の投稿） | 他人の投稿に削除ボタン | 削除ボタンが表示されない |

### 2.3 音声プレーヤーコンポーネント
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 初期表示 | 音声プレーヤーの初期表示 | 再生ボタンと再生時間が表示される |
| 再生/一時停止 | 再生ボタンの動作 | 音声が再生/一時停止される |
| シークバー | 再生位置の変更 | 指定した位置から再生される |
| 波形表示 | 音声波形の表示 | 波形画像が表示される |
| AI要約表示 | AIによる要約表示 | AI要約テキストが表示される |

### 2.4 投稿作成画面
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| メディアタイプ選択 | 投稿タイプの選択画面 | 音声、画像、テキストの選択肢が表示される |
| 音声録音 | 録音開始・停止 | 録音が開始/停止され、プレビューが表示される |
| 音声ファイル選択 | ファイルから音声選択 | 選択した音声ファイルがプレビューされる |
| カメラ撮影 | カメラで画像撮影 | 撮影した画像がプレビューされる |
| ギャラリー選択 | ギャラリーから画像選択 | 選択した画像がプレビューされる |
| 文字数カウント | テキスト入力時の文字数表示 | 現在の文字数/10000が表示される |
| 文字数超過警告 | 10,000文字超過時 | 警告が表示され、投稿ボタンが無効になる |
| ハッシュタグ追加 | ハッシュタグの追加 | 入力したハッシュタグが追加される |
| ハッシュタグ上限 | 6個目のハッシュタグ追加 | 5個までしか追加されず、警告が表示される |

### 2.5 削除確認ダイアログ
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| メッセージ表示 | 削除確認ダイアログの表示 | 「投稿を削除しますか？」と警告メッセージが表示される |
| 削除ボタン | 削除ボタンの動作 | 削除処理が実行される |
| キャンセルボタン | キャンセルボタンの動作 | ダイアログが閉じる |

## 3. 統合テスト

### 3.1 投稿フロー全体
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| テキスト投稿フロー | テキスト投稿の作成からタイムライン表示まで | 投稿がタイムラインに表示される |
| 音声投稿フロー | 音声録音から投稿、再生まで | 音声プレーヤー付きでタイムラインに表示される |

### 3.2 いいね・コメント連携
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 連携機能 | いいねとコメントの同期更新 | いいね数とコメント数がリアルタイムに更新される |

### 3.3 オフライン→オンライン同期
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| オフライン同期 | オフライン時の投稿がオンライン復帰後に送信 | オフライン保存後、ネットワーク復帰時に自動送信される |

### 3.4 プッシュ通知連携
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| いいね通知 | いいね通知の受信と処理 | 通知バッジ表示、タップで該当投稿に遷移 |

## 4. E2Eテスト

### 4.1 完全な投稿作成フロー
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| テキスト投稿完全フロー | ログインから投稿、いいね、コメントまで | 全ての操作が正常に完了する |
| 音声投稿完全フロー | 録音から投稿、タイムラインで再生まで | 音声録音・再生が正常に動作する |
| 画像投稿完全フロー | ギャラリー選択から投稿まで | 画像が正しくアップロード・表示される |

### 4.2 オフライン機能E2E
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| オフライン閲覧 | 投稿を保存し、オフラインで閲覧・再生 | オフラインでもコンテンツが閲覧・再生できる |

### 4.3 複数アカウント切り替えE2E
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| アカウント切り替え | メインからサブアカウントへ切り替え | タイムラインが切り替わり、各アカウントの投稿が表示される |

### 4.4 パフォーマンステスト
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| 大量スクロール | 100件の投稿を高速スクロール | 10秒以内に完了、メモリリークなし |
| 連続音声再生 | 5つの音声投稿を連続再生 | スムーズに再生、メモリ使用量が適切 |

### 4.5 エラーケースE2E
| テストケース | 説明 | 期待結果 |
|------------|------|---------|  
| ネットワークエラー | オフライン時の投稿と復帰後の自動送信 | オフライン保存、復帰後自動送信 |
| レート制限 | 1分間に11件の投稿試行 | 11件目でレート制限エラー、カウントダウン表示 |

## テスト実行手順

### テストコマンド
| コマンド | 説明 |
|---------|------|
| npm test | 全てのテストを実行 |
| npm run test:watch | 変更を監視してテストを自動実行 |
| npm run test:coverage | カバレッジレポートを生成 |
| npm run test:e2e | iOSでE2Eテストを実行 |
| npm run test:e2e:android | AndroidでE2Eテストを実行 |

## まとめ

このテスト仕様書では、タイムライン・投稿機能の包括的なテストケースを定義しました。

### カバレッジ目標
- APIユニットテスト: 90%以上
- UIユニットテスト: 85%以上
- 結合テスト: 主要フローの80%以上
- E2Eテスト: クリティカルパスの100%

### テスト実行時間目標
- ユニットテスト: 5分以内
- 結合テスト: 10分以内
- E2Eテスト: 20分以内

### 継続的改善
- テストケースは機能追加に応じて更新
- パフォーマンステストの閾値は実測値に基づいて調整
- E2Eテストは安定性を重視し、不安定なテストは改善または削除