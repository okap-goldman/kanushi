# AIチャット・検索機能 テスト仕様書

## 概要
本ドキュメントは、AIチャット・検索機能のTDD実装のための詳細なテスト仕様書です。
Claude Codeによる実装時の品質保証と動作検証を目的としています。

## 1. API単体テスト

### 1.1 検索API

**テストケース**: キーワードによる検索（ユーザー、投稿、ハッシュタグ）
- **入力**: 検索キーワード
- **期待結果**: ユーザー、投稿、ハッシュタグの検索結果を含むオブジェクト

**テストケース**: 空の検索結果
- **入力**: 存在しないキーワード
- **期待結果**: 各カテゴリが空の配列を含むレスポンス

**テストケース**: カテゴリごとの詳細検索
- **入力**: 検索キーワード、カテゴリ指定
- **期待結果**: 指定したカテゴリの詳細検索結果

**テストケース**: フィルタ付き検索
- **入力**: 検索キーワード、フィルタ条件（日付範囲など）
- **期待結果**: フィルタを適用した検索結果

**テストケース**: ページネーション対応検索
- **入力**: 検索キーワード、ページパラメータ
- **期待結果**: ページ情報を含む検索結果

**テストケース**: ネットワークエラーハンドリング
- **入力**: 有効なキーワード、ネットワーク障害状態
- **期待結果**: 適切なエラーオブジェクト

### 1.2 AIチャットAPI

**テストケース**: ユーザークエリ送信
- **入力**: ユーザーの質問テキスト
- **期待結果**: AIの回答テキスト

**テストケース**: 会話コンテキスト維持
- **入力**: 前の会話がある状態での新しい質問
- **期待結果**: コンテキストを考慮した回答

**テストケース**: AIモデル選択
- **入力**: 質問とモデル種別（標準/詳細）
- **期待結果**: 選択したモデルからの適切な回答

**テストケース**: 長時間実行時のタイムアウト処理
- **入力**: 処理に時間がかかる複雑な質問
- **期待結果**: タイムアウトハンドリングとエラー情報

**テストケース**: 非同期レスポンスストリーミング
- **入力**: ストリーミングモードでの質問
- **期待結果**: 回答の部分的な逐次配信

**テストケース**: 不適切なコンテンツフィルタリング
- **入力**: ポリシー違反となる質問
- **期待結果**: 適切なフィルタリングと警告メッセージ

## 2. UIコンポーネントテスト

### 2.1 検索バーコンポーネント

**テストケース**: 検索バーの基本レンダリング
- **入力**: 初期表示
- **期待結果**: 検索入力フィールドとアイコンが表示される

**テストケース**: 検索キーワード入力
- **入力**: テキスト入力
- **期待結果**: 入力内容が表示され、状態が更新される

**テストケース**: 検索実行
- **入力**: キーワード入力後のエンターキー押下
- **期待結果**: onSearch関数が入力したキーワードで呼び出される

**テストケース**: 検索クリア機能
- **入力**: クリアボタンクリック
- **期待結果**: 入力フィールドがクリアされる

**テストケース**: フォーカス/ブラー状態の視覚的フィードバック
- **入力**: フォーカス取得/喪失
- **期待結果**: スタイルが適切に変化する

**テストケース**: 自動提案機能
- **入力**: 文字入力中
- **期待結果**: 入力に合わせたサジェスト表示

### 2.2 検索結果コンポーネント

**テストケース**: 検索結果のレンダリング
- **入力**: 検索結果データ
- **期待結果**: タブ付きの結果表示（ユーザー/投稿/ハッシュタグ）

**テストケース**: タブ切り替え
- **入力**: タブクリック
- **期待結果**: 選択したカテゴリの結果が表示される

**テストケース**: 結果が空の場合の表示
- **入力**: 結果が空の検索データ
- **期待結果**: 「結果がありません」メッセージの表示

**テストケース**: 結果項目のインタラクション
- **入力**: 結果アイテムクリック
- **期待結果**: onSelectItem関数が適切なデータで呼ばれる

**テストケース**: 無限スクロール機能
- **入力**: 結果リストの最下部までスクロール
- **期待結果**: 追加データのロード処理が発生

### 2.3 AIチャットインターフェース

**テストケース**: チャットUIの基本レンダリング
- **入力**: 初期表示
- **期待結果**: メッセージリストと入力エリアが表示される

**テストケース**: チャット履歴の初期表示
- **入力**: AIチャット画面を開く
- **期待結果**: 直近3件のチャット履歴が表示される（セッションタイトル、最終メッセージプレビュー、最終更新日時）

**テストケース**: チャット履歴が3件未満の場合
- **入力**: チャット履歴が2件のみ存在する状態で画面を開く
- **期待結果**: 存在する2件のチャット履歴のみが表示される

**テストケース**: チャット履歴が存在しない場合
- **入力**: チャット履歴が0件の状態で画面を開く
- **期待結果**: 「チャット履歴がありません」メッセージと新規チャット開始ボタンが表示される

**テストケース**: チャット履歴項目のタップ
- **入力**: チャット履歴項目をタップ
- **期待結果**: 選択したセッションの全メッセージが表示され、会話を継続できる状態になる

**テストケース**: メッセージ送信
- **入力**: テキスト入力と送信
- **期待結果**: 入力内容がユーザーメッセージとして表示され、AIの応答が表示される

**テストケース**: メッセージ履歴表示
- **入力**: 複数のメッセージがある状態
- **期待結果**: ユーザーとAIのメッセージが時系列順に表示される

**テストケース**: ローディング状態表示
- **入力**: メッセージ送信後、応答待ち状態
- **期待結果**: ローディングインジケータが表示される

**テストケース**: エラー状態表示
- **入力**: AIレスポンス取得失敗
- **期待結果**: エラーメッセージと再試行オプションが表示される

**テストケース**: ストリーミングレスポンス表示
- **入力**: ストリーミングモードでのメッセージ送信
- **期待結果**: AIの応答がタイピングアニメーションで段階的に表示される

## 3. 統合テスト

### 3.1 検索フロー統合テスト

**テストケース**: 検索から結果表示までの統合フロー
- **手順**:
  1. 検索バーの表示
  2. キーワード入力
  3. 検索実行
  4. 検索API呼び出し
  5. 結果表示
  6. 結果アイテム選択
- **期待結果**: エンドツーエンドで検索フローが正常に動作する

**テストケース**: 検索フィルタと詳細検索フロー
- **手順**:
  1. 詳細検索オプション表示
  2. フィルタ条件設定
  3. 検索実行
  4. フィルタ適用結果表示
- **期待結果**: フィルタリングを含む検索フローが正常に動作する

### 3.2 AIチャット統合テスト

**テストケース**: チャット会話フローの統合テスト
- **手順**:
  1. チャットインターフェース表示
  2. 初期メッセージ送信
  3. AI応答受信
  4. フォローアップ質問送信
  5. コンテキストを考慮した応答受信
- **期待結果**: 一連のチャットフローが正常に動作する

**テストケース**: チャット履歴からの会話継続フロー
- **手順**:
  1. AIチャット画面表示
  2. 直近3件のチャット履歴が表示される
  3. 特定の履歴項目をタップ
  4. 選択したセッションの全メッセージが表示される
  5. 新しいメッセージを送信
  6. 過去のコンテキストを考慮したAI応答受信
- **期待結果**: 過去の会話履歴から継続してチャットができる

**テストケース**: ユーザーコンテキストを活用したAI応答
- **手順**:
  1. ユーザー情報が利用可能な状態
  2. パーソナライズされた質問送信
  3. ユーザー情報を考慮した応答受信
- **期待結果**: AIがユーザーコンテキストを考慮した回答を提供する

## 4. E2Eテスト

### 4.1 検索E2Eテスト

**テストケース**: モバイルアプリでの検索体験
- **手順**:
  1. アプリ起動
  2. 検索画面ナビゲーション
  3. キーワード入力
  4. 実際のAPIと通信
  5. 結果表示と詳細画面遷移
- **期待結果**: 実際の環境での検索機能が正常に動作する

**テストケース**: 検索結果からのアクション連携
- **手順**:
  1. 検索実行
  2. ユーザー検索結果選択
  3. プロフィール表示
  4. フォローアクション実行
- **期待結果**: 検索結果からの派生アクションが正常に機能する

### 4.2 AIチャットE2Eテスト

**テストケース**: 実環境でのAIチャット完全フロー
- **手順**:
  1. アプリ起動
  2. AIアシスタント画面表示
  3. 複数ターンの会話実施
  4. 画像付き応答受信
  5. リンクインタラクション
- **期待結果**: 実際のAPIと通信するE2Eフローが正常に動作する

**テストケース**: AIチャットの長時間セッション
- **手順**:
  1. チャットセッション開始
  2. 複数の質問と回答
  3. アプリ切り替え
  4. 復帰後の会話継続
- **期待結果**: セッションが適切に維持され、コンテキストが保持される

## 5. パフォーマンステスト

**テストケース**: 検索レスポンス時間
- **入力**: 大量データでの検索クエリ
- **期待結果**: 応答時間が3秒以内

**テストケース**: AIチャットレスポンス時間
- **入力**: 標準的な質問
- **期待結果**: 初回トークン受信までが2秒以内

**テストケース**: メモリ使用量
- **入力**: 長時間のチャットセッション
- **期待結果**: メモリリークなし、安定したメモリ使用パターン