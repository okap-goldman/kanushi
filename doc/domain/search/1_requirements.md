# 検索・AIドメイン要件定義

## 概要
検索・AIドメインは、アプリケーション内のコンテンツ検索機能とAIチャット機能を管理します。ユーザーや投稿の検索、AIを活用した対話型チャット、検索履歴の管理と分析を含みます。

## 検索機能 (SEARCH)

### 要素
- **string query** - 検索クエリ
- **enum search_type** - 検索対象タイプ（user | post | all）
- **array filters** - 検索フィルター（タグ、日付範囲など）
- **integer limit** - 結果の制限数
- **integer offset** - ページネーション用オフセット

### 機能
- ユーザー検索
- 投稿検索
- 検索結果のフィルタリング
- 検索結果のページネーション
- 検索サジェスト提供

### 要件
- エンジン: MariaDB全文検索
- 複数の検索対象のサポート（ユーザー、投稿）
- 検索クエリのサジェスト機能
- 日本語・英語の自然言語検索対応
- ユーザーごとの検索上限: 1日あたり5回
- 検索結果は関連性の高い順に表示

## AIチャット機能 (CHAT)

### 要素
- **UUID id** - チャットセッション固有ID
- **UUID user_id** - ユーザーID
- **datetime created_at** - 作成日時
- **datetime ended_at** - 終了日時（任意）

### 機能
- AIとの対話型チャット
- チャットセッションの作成・管理
- チャットログの保存と取得
- コンテキスト保持による継続的な会話

### 要件
- 使用モデル: "Gemini 2.5 Pro"
- 継続的なコンテキスト保持
- チャットログの保存期間: 10年
- APIキー管理はサービス側で実施
- 同時セッション数の制限

## チャットメッセージ (CHAT_MESSAGE)

### 要素
- **UUID id** - メッセージ固有ID
- **UUID session_id** - セッションID
- **UUID user_id** - ユーザーID
- **enum role** - 役割（user | assistant）
- **text content** - メッセージ内容
- **datetime created_at** - 作成日時

### 機能
- メッセージの送受信
- メッセージ履歴の取得
- メッセージの保存

### 要件
- ユーザーとアシスタント（AI）の区別
- テキストベースのメッセージサポート
- タイムスタンプ付きのメッセージ記録

## 検索履歴 (SEARCH_HISTORY)

### 要素
- **UUID id** - 検索履歴固有ID
- **UUID user_id** - ユーザーID
- **text query** - 検索クエリ
- **datetime searched_at** - 検索実行日時

### 機能
- ユーザーの検索履歴記録
- 検索履歴の取得と表示
- 検索履歴に基づく推薦コンテンツ生成

### 要件
- ユーザーごとの検索履歴保存
- プライバシー設定によるアクセス制御
- 検索履歴の削除オプション
- 個人化された推薦に活用

## API

### 検索関連
- `GET /search` - コンテンツ検索API
- `GET /search/suggestions` - 検索サジェスト取得API
- `GET /search/history` - 検索履歴取得API
- `DELETE /search/history/:id` - 特定の検索履歴削除API

### チャット関連
- `GET/POST /chat/sessions` - チャットセッション管理API
- `GET/POST /chat/sessions/:id/messages` - チャットメッセージ管理API
- `DELETE /chat/sessions/:id` - チャットセッション削除API

## 非機能要件

### セキュリティ
- 検索クエリとチャット内容の暗号化
- プライベート情報へのアクセス制限
- AIチャットでの個人情報取り扱いポリシー
- リクエスト制限によるDDoS対策

### パフォーマンス
- 検索結果の高速応答（500ms以内）
- インデックス最適化
- キャッシュ戦略の実装
- AIチャットのレスポンスタイム最適化

### スケーラビリティ
- 検索エンジンの水平スケーリング
- AIモデルの更新・変更への対応
- 将来的な検索対象の拡張サポート
- ロードバランシングとシャーディング対応

### 可用性
- 検索サービスの高可用性（99.9%以上）
- チャットサービスのフェイルオーバー
- バックアップと復元メカニズム
- サービス中断時の代替手段提供